(()=>{let a=[],e=[],t=!1,n=0,c="";function o(){a[n]&&a.length>n&&chrome.tabs.query({active:!0,currentWindow:!0},(async function(e){e[0]&&chrome.tabs.sendMessage(e[0].id,{action:"getItemDetail",url:a[n].storeUrl})}))}chrome.runtime.onMessage.addListener((async function(r,s,i){"startScraping"===r.action?(t=!0,c=r.searchTerm,a=[],n=0,chrome.tabs.query({active:!0,currentWindow:!0},(function(a){a[0]&&chrome.tabs.sendMessage(a[0].id,{action:"redirectHome"})}))):"readySearch"===r.action?t&&chrome.tabs.query({active:!0,currentWindow:!0},(function(a){a[0]&&chrome.tabs.sendMessage(a[0].id,{action:"startScraping",searchTerm:c})})):"stopScraping"===r.action?t=!1:"resumeScraping"===r.action?(t=!0,a[n]&&t&&o()):"pauseScraping"===r.action?t=!1:"sendAppList"===r.action?(a=r.data,a[n]&&t&&o()):"sendItemDetail"===r.action?t&&(await chrome.storage.local.get(["appData"]).then((a=>{e=a.appData?a.appData:[]})),e.some((a=>a.id===r.data.id))||(e.push(r.data),a=a.concat(r.similarApps),chrome.runtime.sendMessage({action:"sendLog",data:r.data,count:e.length})),await chrome.storage.local.set({appData:e}),n+=1,o()):"readyReadDetail"===r.action?chrome.tabs.query({active:!0,currentWindow:!0},(async function(e){e[0]&&chrome.tabs.sendMessage(e[0].id,{action:"sendItemsDetail",data:a[n]})})):"clearCSV"===r.action?(e=[],await chrome.storage.local.set({appData:e})):"getCSV"===r.action&&(await chrome.storage.local.get(["appData"]).then((a=>{e=a.appData?a.appData:[]})),chrome.runtime.sendMessage({action:"sendCSV",data:e}))})),chrome.runtime.onConnect.addListener((async function(a){"popup"===a.name&&(await chrome.storage.local.get(["appData"]).then((a=>{e=a.appData?a.appData:[]})),chrome.runtime.sendMessage({action:"sendHistory",data:e,searchTerm:c}),a.onDisconnect.addListener((function(){t=!1})))}))})();